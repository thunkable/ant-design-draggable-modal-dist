import{createContext as e,createElement as n,useState as i,useCallback as t,useEffect as r,useRef as o,memo as d,useMemo as a,useContext as u,useReducer as s}from"react";import{useUID as w}from"react-uid";import{Modal as h}from"antd";var m=function(){return(m=Object.assign||function(e){for(var n,i=1,t=arguments.length;i<t;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};var l=e(null),c=function(e){return n("div",m({className:"ant-design-draggable-modal-resize-handle"},e),n("div",{className:"ant-design-draggable-modal-resize-handle-inner"}))},f={margin:0,paddingBottom:0,pointerEvents:"auto"},v=d(function(e){var d=e.id,u=e.modalState,s=e.dispatch,w=e.visible,l=e.children,v=e.title,x=function(e,n){var i={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(i[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(t=Object.getOwnPropertySymbols(e);r<t.length;r++)n.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(i[t[r]]=e[t[r]])}return i}(e,["id","modalState","dispatch","visible","children","title"]);r(function(){return s({type:"mount",id:d}),function(){return s({type:"unmount",id:d})}},[s,d]);var g,p,y=(g=w,p=o(null),r(function(){p.current=g}),p.current);r(function(){w!==y&&s(w?{type:"show",id:d}:{type:"hide",id:d})},[w,y,d,s]);var z=u.zIndex,b=u.x,I=u.y,S=u.width,D=u.height,O=a(function(){return m(m({},f),{top:I,left:b,height:D})},[I,b,D]),X=t(function(){return s({type:"focus",id:d})},[d,s]),Y=t(function(e){return s(m({type:"drag",id:d},e))},[s,d]),Z=t(function(e){return s(m({type:"resize",id:d},e))},[s,d]),E=function(e,n,o){var d=i(!1),a=d[0],u=d[1],s=i({initX:0,initY:0,mouseDownX:0,mouseDownY:0}),w=s[0],h=s[1],m=t(function(i){i.preventDefault(),h({initX:e,initY:n,mouseDownX:i.clientX,mouseDownY:i.clientY}),u(!0)},[e,n,u,h]);return r(function(){var e=function(e){if(a){var n=w.initX,i=w.mouseDownX,t=w.initY,r=w.mouseDownY,d=e.clientX-i,u=e.clientY-r;o({x:n+d,y:t+u})}};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}},[w,a,o]),r(function(){var e=function(){u(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}},[u]),m}(b,I,Y),j=function(e,n,o,d,a){var u=i(!1),s=u[0],w=u[1],h=i({initX:0,initY:0,initWidth:0,initHeight:0,mouseDownX:0,mouseDownY:0}),m=h[0],l=h[1],c=t(function(i){i.preventDefault(),l({initX:e,initY:n,initWidth:o,initHeight:d,mouseDownX:i.clientX,mouseDownY:i.clientY}),w(!0)},[o,d,w,l,e,n]);return r(function(){var e=function(e){if(s){var n=m.initX,i=m.initY,t=m.initWidth,r=m.mouseDownX,o=m.initHeight,d=m.mouseDownY,u=e.clientX-r,w=e.clientY-d;return a({x:n,y:i,width:t+u,height:o+w})}};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}},[m,s,a]),r(function(){var e=function(){w(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}},[w]),c}(b,I,S,D,Z),L=a(function(){return n("div",{className:"ant-design-draggable-modal-title",onMouseDown:E,onClick:X},v)},[E,X,v]);return n(h,m({wrapClassName:"ant-design-draggable-modal",style:O,width:S,destroyOnClose:!0,mask:!1,maskClosable:!1,zIndex:z,title:L,visible:w},x),l,n(c,{onMouseDown:j}))});v.displayName="DraggableModalInner";var x=function(){return{width:window.innerWidth||0,height:window.innerHeight||0}},g=function(e,n,i){return Math.max(e,Math.min(n,i))},p=function(e,n){return Object.assign.apply(Object,function(){for(var e=0,n=0,i=arguments.length;n<i;n++)e+=arguments[n].length;var t=Array(e),r=0;for(n=0;n<i;n++)for(var o=arguments[n],d=0,a=o.length;d<a;d++,r++)t[r]=o[d];return t}([{}],Object.keys(e).map(function(i){var t;return(t={})[i]=n(e[i]),t})))},y={maxZIndex:0,windowSize:x(),modals:{}},z={x:0,y:0,width:570,height:400,zIndex:0,visible:!1},b=function(e,n){return e.modals[n]||z},I=function(e,n){return b(e,n).zIndex===e.maxZIndex?e.maxZIndex:e.maxZIndex+1},S=function(e,n,i,t,r,o){var d=n-o;return{x:g(0,e-r,i),y:g(0,d,t)}},D=function(e,n,i,t,r,o){var d=n-t;return{width:g(200,e-i,r),height:g(200,d,o)}},O=function(e,n){var i,t,r,o,d,a;switch(n.type){case"resize":var u=D(e.windowSize.width,e.windowSize.height,n.x,n.y,n.width,n.height);return m(m({},e),{maxZIndex:I(e,n.id),modals:m(m({},e.modals),(i={},i[n.id]=m(m(m({},e.modals[n.id]),u),{zIndex:I(e,n.id)}),i))});case"drag":return m(m({},e),{maxZIndex:I(e,n.id),modals:m(m({},e.modals),(t={},t[n.id]=m(m(m({},e.modals[n.id]),S(e.windowSize.width,e.windowSize.height,n.x,n.y,e.modals[n.id].width,e.modals[n.id].height)),{zIndex:I(e,n.id)}),t))});case"show":var s=e.modals[n.id],w=e.windowSize.width/2-s.width/2,h=e.windowSize.height/2-s.height/2,l=S(e.windowSize.width,e.windowSize.height,w,h,s.width,s.height),c=D(e.windowSize.width,e.windowSize.height,l.x,l.y,s.width,s.height);return m(m({},e),{maxZIndex:e.maxZIndex+1,modals:m(m({},e.modals),(r={},r[n.id]=m(m(m(m({},s),l),c),{zIndex:e.maxZIndex+1,visible:!0}),r))});case"focus":var f=e.modals[n.id];return m(m({},e),{maxZIndex:e.maxZIndex+1,modals:m(m({},e.modals),(o={},o[n.id]=m(m({},f),{zIndex:e.maxZIndex+1}),o))});case"hide":var v=e.modals[n.id];return m(m({},e),{modals:m(m({},e.modals),(d={},d[n.id]=m(m({},v),{visible:!1}),d))});case"mount":return m(m({},e),{maxZIndex:e.maxZIndex+1,modals:m(m({},e.modals),(a={},a[n.id]=m(m({},z),{x:e.windowSize.width/2-z.width/2,y:e.windowSize.height/2-z.height/2,zIndex:e.maxZIndex+1}),a))});case"unmount":var x=m({},e.modals);return delete x[n.id],m(m({},e),{modals:x});case"windowResize":return m(m({},e),{windowSize:n.size,modals:p(e.modals,function(n){if(!n.visible)return n;var i=S(e.windowSize.width,e.windowSize.height,n.x,n.y,n.width,n.height),t=D(e.windowSize.width,e.windowSize.height,i.x,i.y,n.width,n.height);return m(m(m({},n),i),t)})});default:throw new Error}},X=function(e){var i=w(),t=u(l);if(!t)throw new Error("No Provider");var r=t.dispatch,o=t.state,d=b(o,i);return n(v,m({id:i,dispatch:r,modalState:d},e))},Y=function(e){var i=e.children,t=s(O,y),o=t[0],d=t[1];return r(function(){if("object"==typeof window){var e=function(){return d({type:"windowResize",size:x()})};return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}},[d]),n(l.Provider,{value:{state:o,dispatch:d}},i)};export{X as DraggableModal,l as DraggableModalContext,Y as DraggableModalProvider};
//# sourceMappingURL=index.es.js.map
